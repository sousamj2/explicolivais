<h1> √Årea Admistrativa - Base de Dados</h1>


<textarea id="sqlInput" placeholder="Write your SQL code here..."></textarea>
<br />

<p>
  <input type="number" id="numberInput" min="0" max="255" value="1" /> Number suffix (0-255)
</p>

<button id="btnUpdatePrefill">Update</button>
<button id="btnPastePrefill">Paste</button>

<button id="submitBtn">Run SQL</button>

<div id="output"></div>

<script>
  const sqlInput = document.getElementById('sqlInput');
  const submitBtn = document.getElementById('submitBtn');
  const output = document.getElementById('output');

  submitBtn.addEventListener('click', async () => {
    const sql = sqlInput.value.trim();
    if (!sql) {
      output.textContent = 'Please enter some SQL code.';
      return;
    }

    submitBtn.disabled = true;
    output.textContent = 'Executing query...';

    try {
      const response = await fetch('/adminDB', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ query: sql })
      });

      const data = await response.json();

      if (response.ok) {
        if (data.html_table) {
          // Backend returned HTML table string
          output.innerHTML = data.html_table;
        } else {
          // Show other data (like rowcount) as JSON formatted text
          output.textContent = JSON.stringify(data, null, 2);
        }
      } else {
        output.textContent = `Error: ${data.error || 'Unknown error'}`;
      }
    } catch (err) {
      output.textContent = `Fetch error: ${err.message}`;
    } finally {
      submitBtn.disabled = false;
    }
  });
</script>

<!-- Add these buttons somewhere above your textarea -->
<div style="margin-bottom: 1rem;">
  <button id="btnGetAll">Get all</button>
  <button id="btnGetColumns">Get columns</button>

  <button id="btnInsertField">Insert field</button>
  <button id="btnDeleteColumn">Delete column</button>
  <button id="btnInsertUser">Insert user</button>
  <button id="btnDeleteRow">Delete user</button>
  <button id="btnTruncateUsers">HARD RESET</button>
  <button id="btnClear">Clear</button>
</div>

<br> <br>
<!-- 
<button id="btnClear">Clear</button>

<textarea id="sqlInput" placeholder="Write your SQL code here..." style="width:100%;height:200px;"></textarea> -->

<script>
  document.getElementById('btnGetColumns').onclick = () => {
    const query = `
  SELECT column_name
  FROM information_schema.columns
WHERE table_name = 'users'
  AND is_nullable = 'NO'
  AND (is_identity = 'NO' OR is_identity IS NULL)
  AND (column_name NOT IN ('id', 'test'))
ORDER BY ordinal_position;

  `.trim();
    document.getElementById('sqlInput').value = query;
  };

  document.getElementById('btnInsertUser').onclick = () => {
    // You fill this yourself manually later
    const query = `INSERT INTO users (col1, col2, ...) VALUES ('val1', 'val2', ...);`;
    document.getElementById('sqlInput').value = query;
  };
  document.getElementById('btnClear').onclick = function () {
    document.getElementById('sqlInput').value = '';
  }
  document.getElementById('btnGetAll').onclick = function () {
    document.getElementById('sqlInput').value = "SELECT * FROM users;";
  };
  document.getElementById('btnInsertField').onclick = function () {
    const column = prompt('Enter the name of the new column:');
    if (!column) return alert('Column name is required.');

    const dataType = prompt('Enter the data type of the new column (e.g., varchar(100), integer):');
    if (!dataType) return alert('Data type is required.');

    document.getElementById('sqlInput').value = `ALTER TABLE users ADD COLUMN ${column} ${dataType};`;
  };
  document.getElementById('btnDeleteColumn').onclick = () => {
    if (confirm('Irreversible action. Are you sure you want to delete this column?')) {
      const columnName = prompt('Enter the name of the column to delete:');
      if (columnName) {
        document.getElementById('sqlInput').value = `ALTER TABLE users DROP COLUMN ${columnName};`;
      }
    }
  };
  document.getElementById('btnDeleteRow').onclick = () => {
    if (confirm('Irreversible action. Are you sure you want to delete a row?')) {
      const id = prompt('Enter the id of the row to delete:');
      if (id) {
        document.getElementById('sqlInput').value = `DELETE FROM users WHERE id = ${id};`;
      }
    }
  };

  document.getElementById('btnTruncateUsers').onclick = function() {
    const confirmMsg = 'Irreversible action: This will remove ALL data from the users table AND reset the ID sequences. Continue?';
    if (!confirm(confirmMsg)) return;

    // Set the SQL command to truncate and restart identity (id) columns
    document.getElementById('sqlInput').value = 'TRUNCATE TABLE users RESTART IDENTITY;';
  };

</script>

<!-- aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa -->


<textarea id="prefillBox" rows="4" style="width: 100%; font-family: monospace;">
INSERT INTO users (name, email, address, zip_code, cell_phone, register_ip, last_login) VALUES ('O meu nome', 'email001@mail.com', 'A minha morada', '1234-567', '900000001', '111.111.111.001', NOW());
</textarea>


<script>
  (function () {
    const prefillBox = document.getElementById('prefillBox');
    const numberInput = document.getElementById('numberInput');
    const sqlInput = document.getElementById('sqlInput');

    // Capture the original template text upon loading
    const originalTemplate = prefillBox.value;

    function padNum(num) {
      return String(num).padStart(3, '0');
    }

    document.getElementById('btnUpdatePrefill').addEventListener('click', () => {
      const num = numberInput.value;
      if (num === '' || isNaN(num) || num < 0 || num > 255) {
        alert('Please enter a valid number from 0 to 255');
        return;
      }
      const paddedNum = padNum(num);
      const updatedText = originalTemplate.replace(/001/g, paddedNum);
      prefillBox.value = updatedText;
    });

    document.getElementById('btnPastePrefill').addEventListener('click', () => {
      sqlInput.value = prefillBox.value;
    });
  })();
</script>

<!-- aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa -->
 
